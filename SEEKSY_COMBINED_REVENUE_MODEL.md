# Seeksy Combined Revenue Model

## Overview

The Combined Revenue Model provides a unified financial view that merges:
- **Subscription/Platform Revenue** - Core SaaS subscriptions, My Page fees, event ticketing, etc.
- **Ad Revenue** - Programmatic ads, host-read ads, PPI campaigns from the Ad Financial Model

This creates a complete 3-year financial projection used for investor presentations and strategic planning.

---

## Routes & Navigation

### Main Route
- **Path**: `/admin/financial-models/combined`
- **Component**: `CombinedFinancialModels.tsx`
- **Access**: Admin-only

### Sidebar Navigation
Located under **Admin → Financials**:
- Financial Overview
- Investor Spreadsheets
- Revenue Reports
- Billing
- Payments
- Ad Revenue Financial Model
- **Combined Revenue Model** ← NEW

---

## Data Architecture

### Subscription Revenue Sources
- **Base**: Current CFO Dashboard financial model
- **Assumptions**: Monthly user growth (15%), subscription tiers, churn rates
- **Source**: `financialOverview` API + state-based projections

### Ad Revenue Sources
- **Tables**:
  - `ad_financial_scenarios` - Base/Conservative/Aggressive cases
  - `ad_financial_assumptions` - CPM rates, fill rates, creator payouts
  - `ad_financial_projections` - Month-by-month ad revenue projections
  - `ad_financial_model_summaries` - Scenario summaries
- **Engine**: `ad-financial-projection` edge function

### Combined Calculation
For each month:
```
subscription_revenue = base_mrr × (1 + monthly_growth)^month_index
ad_revenue = from ad_financial_projections table
total_revenue = subscription_revenue + ad_revenue

subscription_payouts = subscription_revenue × 0.75 (75% to creators)
ad_payouts = from ad_financial_projections.creator_payout
total_payouts = subscription_payouts + ad_payouts

net_profit = total_revenue - total_payouts
gross_margin = (total_revenue - total_payouts) / total_revenue × 100
```

---

## UI Components

### Top Metrics Strip
Four summary cards showing Year 3 projections:
1. **Total Revenue** - Combined subscription + ad revenue
2. **% Revenue from Ads** - Ad revenue as % of total
3. **Creator Payouts** - Total payouts to creators
4. **Net Margin** - Gross margin %

### Three-Column Layout

#### Left: AI-Generated Combined Pro Forma
- Scenario selector: Conservative / Base / Aggressive
- Applies multipliers to combined projections:
  - Conservative: 0.75×
  - Base: 1.0×
  - Aggressive: 1.35×
- Yearly breakdown with subscription vs ad split
- Export PDF/Excel

#### Middle: Custom 3-Year Combined Pro Forma
- Uses real projections from both models
- Yearly cards with detailed breakdown
- Stacked area chart showing subscription vs ad revenue
- Export PDF/Excel

#### Right: CFO AI Chat
- Enhanced with combined revenue context
- Can answer questions like:
  - "What's our total revenue in Year 2 combining subscriptions and ads?"
  - "How much of Year 3 revenue comes from advertising vs subscriptions?"
  - "What's our projected net profit growth year over year?"

### Detailed Charts
- **Monthly Revenue Breakdown**: Line chart showing 36-month projection
- **Subscription Revenue** (blue line)
- **Ad Revenue** (green line)
- **Total Revenue** (yellow line, bold)

---

## Export Functionality

### PDF Export
- Header: "Combined 3-Year Revenue Model"
- 3-year summary with yearly breakdowns
- Subscription vs Ad split
- Net profit and gross margin
- Footer: "Generated by Seeksy Financial Models"

### Excel/CSV Export
Columns:
- Year
- Subscription Revenue
- Ad Revenue
- Total Revenue
- Total Payouts
- Net Profit
- Gross Margin %

---

## CFO AI Integration

### Enhanced Context
The `cfo-ai-assistant` edge function now includes:

1. **Combined Revenue Model Data**
   - Fetches ad projections from `ad_financial_projections`
   - Calculates subscription projections using growth model
   - Combines monthly data into yearly summaries
   - Provides breakdown: total, subscription %, ad %

2. **Context Format**
```
** COMBINED REVENUE MODEL (Subscriptions + Ads) **

Year 1:
  - Total Revenue: $X.XM
  - Subscription Revenue: $X.XM (XX%)
  - Ad Revenue: $X.XM (XX%)
  - Creator Payouts: $X.XM
  - Net Profit: $X.XM
  - Gross Margin: XX%
```

3. **Query Capabilities**
- Total platform revenue (both streams)
- Individual stream breakdowns
- Year-over-year growth
- Revenue mix and trends
- Creator payout calculations
- Margin analysis

---

## Implementation Files

### New Files Created
1. **`src/hooks/useCombinedFinancialData.tsx`**
   - Hook for fetching and combining financial data
   - Merges subscription + ad projections
   - Calculates monthly and yearly summaries
   - Returns combined metrics

2. **`src/pages/admin/CombinedFinancialModels.tsx`**
   - Main page component
   - Three-column layout
   - Charts and export functionality
   - CFO AI integration

### Modified Files
1. **`src/App.tsx`**
   - Added import: `CombinedFinancialModels`
   - Added route: `/admin/financial-models/combined`

2. **`src/components/AppSidebar.tsx`**
   - Added nav item: "Combined Revenue Model"
   - Icon: `LineChart`
   - URL: `/admin/financial-models/combined`

3. **`supabase/functions/cfo-ai-assistant/index.ts`**
   - Added combined revenue calculation
   - Enhanced context with yearly summaries
   - Updated system prompt for combined queries

---

## Testing Checklist

✅ **Routes**
- `/admin/financial-models/combined` loads without 404
- Sidebar "Combined Revenue Model" is visible for admin
- Active state highlights correctly

✅ **Data Sanity**
- Combined revenue = subscriptions + ads
- Missing data handled gracefully (treats as zero)
- Year 3 metrics display correctly

✅ **CFO AI**
- Can answer: "What is our total projected revenue over 3 years?"
- Can answer: "In Year 3, what percentage of revenue is ad-based?"
- Can answer: "What's the breakdown between subscriptions and ads in Year 2?"

✅ **Exports**
- PDF downloads with "Combined" in title
- Excel/CSV exports with all columns
- Data matches on-screen projections

---

## Future Enhancements

1. **Scenario Comparison**
   - Side-by-side comparison of Base vs Conservative vs Aggressive
   - Delta calculations and variance analysis

2. **Monthly Drilldown**
   - Expand yearly cards to show monthly breakdown
   - Interactive month selector

3. **Investor Dashboard**
   - Public-facing view with access code
   - Simplified, presentation-ready layout
   - Embeddable charts and metrics

4. **Real-Time Data Integration**
   - Pull actual revenue from Stripe/payment processors
   - Compare actuals vs projections
   - Variance tracking and alerts

---

## Access & Permissions

**Admin Only**: Combined Revenue Model is restricted to users with admin role via RLS and navigation guards.

**CFO AI**: Available to all admin users within the Combined Revenue Model page.

**Export**: PDF and Excel exports include watermark and timestamp for version control.
